var blob,audio=new Audio("assets/sounds/button.mp3"),audioUpload=new Audio("assets/sounds/buttonTwo.wav"),video=document.querySelector("#video"),canvas=document.querySelector("#canvas"),context=canvas.getContext("2d"),photo=document.querySelector("#photo"),constraints={audio:!1,video:{width:320,height:240}};navigator.mediaDevices.getUserMedia(constraints).then(function(e){video.srcObject=e,video.onloadedmetadata=function(e){video.play()}}).catch(function(e){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUsermedia,navigator.getMedia({video:!0,audio:!1},function(e){video.srcObject=e,video.play()},function(e){console.log(e)})}),document.querySelector("#capture").addEventListener("click",function(){audio.play(),context.drawImage(video,0,0,320,240),photo.setAttribute("src",canvas.toDataURL("image/jpeg",1)),function(e){for(var a=atob(e.split(",")[1]),t=new ArrayBuffer(a.length),o=new Uint8Array(t),l=0;l<a.length;l++)o[l]=a.charCodeAt(l);blob=new Blob([t],{type:"image/jpeg"})}(canvas.toDataURL("image/jpeg",1)),uploadFile()});var downloadURL,file,storageRef,thisRef,mood,name,artistName,previewURL,albumName,config={apiKey:"AIzaSyCyH6JqbOa6Ps_v0IMcyedDvoFzUAkhRds",authDomain:"https://mood-and-music.firebaseapp.com",databaseURL:"https://mood-and-music.firebaseio.com",storageBucket:"mood-and-music.appspot.com"},fileUploaded=!1,urlRetrieved=!1;function uploadFile(){var e;void 0===(file=$("#files").get(0).files[0])?(file=blob,e="placeholder"):e=file.name,void 0!==file&&(storageRef=firebase.storage().ref(),(thisRef=storageRef.child(e)).put(file).then(function(e){fileUploaded=!fileUploaded,console.log("File Uploaded"),audioUpload.play(),fileUploaded&&thisRef.getDownloadURL().then(function(e){downloadURL=e,fileUploaded=!fileUploaded,urlRetrieved=!urlRetrieved,console.log("URL Retrieved"),function(){if(urlRetrieved){var e="Cr6V9f2rl8RJDzQQp1ZFRwosg73K8k0MOcOCf4d119E";$.ajax({url:"https://apis.paralleldots.com/v3/facial_emotion?api_key="+e+"&url="+downloadURL,method:"POST"}).then(function(o){if(o.code>=400||"No face detected."===o.output){console.log("You are probably a robot with no emotions"),$(".preview").empty().hide("scale");let e=$('<br><p class="errBox white-text">');$(".preview").append(e).show("scale",1050),e.html("You're probably an emotionless robot. Please upload another image file with a headshot and sufficient lighting.")}else if(403===o.code){e="n3yLuB3RxgDcj5DYAxaxtqxbNqtszhif3dvP4wtrtYE",$(".preview").empty().hide("scale");let a=$('<br><p class="errBox white-text">');$(".preview").append(a).show("scale",1050),a.html("API key changed, please try again.")}else console.log(o.facial_emotion[0].tag),mood=o.facial_emotion[0].tag,function(){switch(mood){case"Angry":a="tra.128493454";break;case"Fear":a="tra.268797739";break;case"Neutral":a="tra.305200130";break;case"Surprise":a="tra.41390755";break;case"Sad":a="tra.2732140";break;case"Happy":a="tra.257617960";break;case"Disgust":a="tra.1341825";break;default:console.log("You are a robot with no emotions")}var e="https://api.napster.com/v2.2/tracks/"+a+"?"+t;$.ajax({url:e,method:"GET"}).then(function(e){var a=e.tracks;console.log(a);var t=$("<audio controls autoplay>"),o=$('<p class="artistInfo center-align white-text">'),l=$('<p class="artistInfo center-align white-text">');$(".preview").empty().hide("scale"),o.html(a[0].name+" by "+a[0].artistName),$(".preview").append(o).show("scale",1050),t.attr("src",a[0].previewURL),$(".preview").attr("id","song").append(t).show("scale",1060),l.html(a[0].albumName+" Album").show("scale",1200),$(".preview").append(l).show("scale",1100),localStorage.clear(),localStorage.setItem("song",a[0].name),localStorage.setItem("artist",a[0].artistName),localStorage.setItem("url",a[0].previewURL),localStorage.setItem("album",a[0].albumName)})}()}),urlRetrieved=!urlRetrieved}}()}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)}));var a,t="apikey=NDU0ZjU2ZWMtMjVhMS00NmNlLWI3NWItYTdlNTc5ODdkMzNk"}if(firebase.initializeApp(config),null!==localStorage.getItem("song")||null!==localStorage.getItem("artist")||null!==localStorage.getItem("url")||null!==localStorage.getItem("album")){var p=$("<p>").addClass("artistInfo center-align white-text").html(localStorage.getItem("song")+" by "+localStorage.getItem("artist"));$(".preview").append(p).show("scale",1050);var a=$("<audio controls autoplay>").attr("src",localStorage.getItem("url"));$(".preview").attr("id","song").append(a).show("scale",1060);var c=$("<p>").addClass("artistInfo center-align white-text").html(localStorage.getItem("album")+" Album").show("scale",1200);$(".preview").append(c).show("scale",1100)}